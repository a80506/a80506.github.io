<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>加密貨幣K線圖</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/techan.js/0.8.0/techan.min.js"></script>
    <style>
        .chart {
            display: inline-block;
            width: 600px;
            height: 400px;
        }
    </style>
</head>
<body>
    <div id="btc-chart" class="chart"></div>
    <div id="eth-chart" class="chart"></div>
    <div id="sol-chart" class="chart"></div>
    <div id="bnb-chart" class="chart"></div>
    <div id="link-chart" class="chart"></div>

    <script>
        const symbols = ['BTCUSDT', 'ETHUSDT', 'SOLUSDT', 'BNBUSDT', 'LINKUSDT'];

        symbols.forEach(symbol => {
            fetchKlineData(symbol);
        });

        function fetchKlineData(symbol) {
            const startTime = new Date('2020-01-01').getTime();
            fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1M&startTime=${startTime}`)
                .then(response => response.json())
                .then(data => {
                    const processedData = data.map(d => ({
                        date: new Date(d[0]),
                        open: +d[1],
                        high: +d[2],
                        low: +d[3],
                        close: +d[4]
                    }));
                    drawChart(symbol.toLowerCase() + '-chart', processedData);
                })
                .catch(err => console.error(err));
        }

        function drawChart(divId, data) {
            const margin = { top: 20, right: 20, bottom: 30, left: 50 },
                width = 600 - margin.left - margin.right,
                height = 400 - margin.top - margin.bottom;

            const x = techan.scale.financetime().range([0, width]);
            const y = d3.scaleLinear().range([height, 0]);

            const svg = d3.select('#' + divId).append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left}, ${margin.top})`);

            const candlestick = techan.plot.candlestick()
                .xScale(x)
                .yScale(y);

            x.domain(data.map(d => d.date));
            y.domain(techan.scale.plot.ohlc(data, candlestick.accessor()).domain());

            svg.append('g')
                .datum(data)
                .attr('class', 'candlestick')
                .call(candlestick);
        }
    </script>
</body>
</html>
