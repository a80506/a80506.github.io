<script>
    var rows = 4;
    var list_table = [
        { // [8] 第三列開始
            title: "加密貨幣",
            items: [
                { div: "UNI", title: "", url: "" },
                { div: "LINK", title: "", url: "" },
                { div: "PYTH", title: "", url: "" },
                { div: "FLOW", title: "", url: "" },
                { div: "MATIC", title: "", url: "" },
                { div: "WLD", title: "", url: "" },
                { div: "LINKBTC", title: "", url: "" },
            ]
        },
        { // [9]
            title: "加密貨幣",
            items: [
                { div: "time", title: "", url: "" },
                { div: "BTC", title: "BTC: 000 (+0%)", url: "" },
                { div: "ETH", title: "ETH: 000 (+0%)", url: "" },
                { div: "SOL", title: "", url: "" },
                { div: "FIL", title: "", url: "" },
                { div: "STRK", title: "", url: "" },
                { div: "ETHBTC", title: "", url: "" },
            ]
        },
        { // [10]
            title: "加密貨幣",
            items: [

                { div: "SSV", title: "", url: "" },
                { div: "ARB", title: "", url: "" },
                { div: "OP", title: "", url: "" },
                { div: "BLUR", title: "", url: "" },
                { div: "ORDI", title: "", url: "" },
                { div: "STX", title: "", url: "" },
				{ div: "XAI", title: "", url: "" },
            ]
        }
    ];
</script>

<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Alex's index</title>
    <style type="text/css">
        body {
            font-size: 9pt;
            background-color: #000000;
        }

        table {
            border-collapse: collapse;
            border-color: #707070;
        }

        td {
            empty-cells: show;
            color: #FFFF00;
            text-align: center;
            border-color: #707070;
        }

        td.title {
            font-weight: bolder;
            color: #000000;
            background-color: #FF9933;
        }

        a {
            color: #FFFF00;
        }

        a {
            text-decoration: none
        }

        a:hover {
            color: #707070;
        }

        div {
            color: #80FF00;
        }
    </style>
    <style type="text/css"></style>
</head>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="
    crossorigin="anonymous"></script>

<body>
    <script>
        var item_title = "";
        var item_url = "";
        var i, j;
        document.write("<table border=\"0\" width=\"100%\" height=\"100%\" align=\"center\" valign=\"center\"><tbody><tr><td>");
        document.write("<table border=\"0\" width=\"75%\" height=\"80%\" align=\"center\"><tbody>");
        document.write("<tr valign=\"top\">");
        for (i = 0; i < list_table.length; i++) {
            document.write("<td>");
            document.write("<table border=\"1\" width=\"280\" align=\"center\"><tbody>");
            document.write("<tr><td class=\"title\">" + list_table[i].title + "</td></tr>");

            for (j = 0; j < 7; j++) {
                item_title = list_table[i].items[j].title;
                item_url = list_table[i].items[j].url;
                item_div = list_table[i].items[j].div;
                if (item_title == "")
                    item_title = "　";

                document.write("<tr><td><div class=\"" + item_div + "\"><a href=\"" + item_url + "\">" + item_title + "</a></div></td></tr>");
            }

            document.write("</tbody></table>");
            document.write("</td>");

            if (i % rows == rows-1) {
                document.write("</tr>");
                document.write("<tr valign=\"top\">");
            }
        }
        document.write("</tr>");
        document.write("</tbody></table>");
        document.write("</td></tr></tbody></table>");
    </script>
</body>
</html>

<script>
    var max = 8;
    var living_room_t = 0, living_room_h = 0;
    var room1_t = 0, room1_h = 0;
    var room2_t = 0, room2_h = 0;
    var room3_t = 0, room3_h = 0;
    var timestamp = 0;
    var fil_reward = 0, fil_storage = 0;

    function get_pm25() {
        $.getJSON("https://data.moenv.gov.tw/api/v2/aqx_p_432?api_key=e8dd42e6-9b8b-43f8-991e-b3dee723a52d&format=JSON",
        function (data) {
            const citiesToCheck = ["新莊", "林口", "菜寮", "五股", "蘆洲", "板橋"];
            let found = 0;
            let site = "";
            let pm25_str = "";

            for (const city of citiesToCheck) {
                for (const record of data.records) {
                    if (record.sitename === city && parseInt(record["pm2.5"]) > 0) {
                        found = 1;
                        site = record.sitename;
                        pm25_str = record["pm2.5"];
                        break;
                    }
                }
                if (found)
                    break;
            }

            if (found) {
                const pm25Value = parseInt(pm25_str);
                const pm25Div = $("div.pm25");

                if (pm25Value > 40) {
                    pm25Div.css("color", "red");
                    pm25Div.css("font-weight", "bold");
                } else if (pm25Value > 20) {
                    pm25Div.css("color", "orange");
                    pm25Div.css("font-weight", "bold");
                }

                pm25Div.html(`${site} PM2.5：${pm25_str}`);
            }
        });
    }

    function change_weather_div(data, station) {
        if (data.ObsTime.DateTime != "") {
            timestamp = Date.parse(data.ObsTime.DateTime);
            if (Date.now() - timestamp > 5400000)
                return 0;
        }
        if (data.WeatherElement) {
            cwb_t = data.WeatherElement.AirTemperature;
            cwb_h = data.WeatherElement.RelativeHumidity;
            cwb_w = data.WeatherElement.Weather;

            if (cwb_t != "" && cwb_h != "" && parseFloat(cwb_t) > -10 && parseFloat(cwb_h) > 0) {
                $("div.weather").html(station + "：" + cwb_t + "°C, " + String(parseInt(cwb_h)) + "%");
                if (parseInt(cwb_h) >= 80) {
                    $("div.weather").css("color", "#46a3ff");
                    $("div.weather").css("font-weight", "bold");
                }
                if (parseInt(cwb_t) >= 32) {
                    $("div.weather").css("color", "red");
                    $("div.weather").css("font-weight", "bold");
                }
                return 1;
            }
        }
        return 0;
    }

    function get_weather_place(data, station) {
        for (var x in data.cwaopendata.dataset.Station) {
            if (data.cwaopendata.dataset.Station[x].StationName == station) {
                found = change_weather_div(data.cwaopendata.dataset.Station[x], station)
                if (found)
                    return 1;
            }
        }
        return 0;
    }

    function get_weather() {
        $.getJSON("https://opendata.cwa.gov.tw/fileapi/v1/opendataapi/O-A0001-001?Authorization=CWB-843040FB-C733-4DFA-8263-47121194BF96&downloadType=WEB&format=JSON",
        function (data) {
            var found = 0;

            const cities = ["新莊", "三重", "五股", "蘆洲", "板橋"];

            for (const city of cities) {
                if (get_weather_place(data, city)) {
                    return;
                }
            }


        });
    }

    /* DHT22 Sensor */
    $.getJSON("https://api.thingspeak.com/channels/72313/feeds.json?results=" + String(max),
        function (data) {
            $.each(data, function (key, val) {
                if (key == "feeds") {
                    for (var i = 0; i < max; i++) {
                        if (Date.now() - Date.parse(val[i].created_at) > 1800000)
                            continue;
                        if (val[i].field1 && val[i].field2) {
                            living_room_t = parseInt(val[i].field1);
                            living_room_h = parseInt(val[i].field2);
                        } else if (val[i].field3 && val[i].field4) {
                            room1_t = parseInt(val[i].field3);
                            room1_h = parseInt(val[i].field4);
                        } else if (val[i].field5 && val[i].field6) {
                            room2_t = parseInt(val[i].field5);
                            room2_h = parseInt(val[i].field6);
                        } else if (val[i].field7 && val[i].field8) {
                            room3_t = parseInt(val[i].field7);
                            room3_h = parseInt(val[i].field8);
                        }
                    }

                    if (living_room_h == 0)
                        $("div.living_room").css("color", "pink");
                    else if (living_room_h >= 80)
                        $("div.living_room").css("color", "red");
                    else if (living_room_h >= 70)
                        $("div.living_room").css("color", "orange");

                    if (room1_h == 0)
                        $("div.room1").css("color", "pink");
                    else if (room1_h >= 80)
                        $("div.room1").css("color", "red");
                    else if (room1_h >= 70)
                        $("div.room1").css("color", "orange");

                    if (room2_h == 0)
                        $("div.room2").css("color", "pink");
                    else if (room2_h >= 80)
                        $("div.room2").css("color", "red");
                    else if (room2_h >= 70)
                        $("div.room2").css("color", "orange");

                    if (room3_h == 0)
                        $("div.room3").css("color", "pink");
                    else if (room3_h >= 80)
                        $("div.room3").css("color", "red");
                    else if (room3_h >= 70)
                        $("div.room3").css("color", "orange");

                    $("div.living_room").html("客廳：" + living_room_t + "°C, " + living_room_h + "%");
                    $("div.room1").html("主臥：" + room1_t + "°C, " + room1_h + "%");
                    $("div.room2").html("礦機：" + room2_t + "°C");
                    $("div.room3").html("書房：" + room3_t + "°C, " + room3_h + "%");
                }
            });
        });

    // FIL reward
    $.getJSON("https://api.thingspeak.com/channels/565880/feeds.json?results=" + String(max),
        function (data) {
            $.each(data, function (key, val) {
                if (key == "feeds") {
                    for (var i = 0; i < max; i++) {
                        if (parseFloat(val[i].field1) > 0) {
                            if (Date.now() - Date.parse(val[i].created_at) > 86400000)
                                continue;
                            fil_reward = parseFloat(val[i].field1);
                            if (parseFloat(val[i].field2) > 0) {
                                if (Date.now() - Date.parse(val[i].created_at) > 86400000)
                                    continue;
                                fil_storage = parseFloat(val[i].field2);
                            }
                        }
                        $("div.fil_reward1").html("FIL: " + fil_storage.toFixed(2) + " / " + fil_reward);
                    }
                }
            });
        });

    // Stock
    $.getJSON("https://api.thingspeak.com/channels/72839/feeds.json?results=" + String(max),
        function (data) {
            var f1 = 0, f2 = 0, f3 = 0, f4 = 0, f5 = 0, f6 = 0;
            var json_len = 0;
            $.each(data, function (key, val) {
                if (key == "feeds") {
                    for (var i = 0; i < max; i++) {
                        if (Date.now() - Date.parse(val[i].created_at) > 86400000)
                            continue;
                        if (val[i].field1)
                            f1 = parseInt(val[i].field1);
                        if (val[i].field2)
                            f2 = parseInt(val[i].field2);
                        if (val[i].field3)
                            f3 = parseFloat(val[i].field3);
                        if (val[i].field4)
                            f4 = parseFloat(val[i].field4);
                        if (val[i].field5)
                            f5 = parseFloat(val[i].field5);
                        if (val[i].field6)
                            f6 = parseFloat(val[i].field6);
                    }
                    var sign = '', sign2 = '';
                    var color = '', color2 = '';
                    if (f2 > 0) {
                        sign = '+';
                        color = 'style="color: red;"';
                    }
                    if (f5 > 0) {
                        sign2 = '+';
                        color2 = 'style="color: red;"';
                    }
                    $("div.TSE").html("<a href='https://tw.stock.yahoo.com/t/idx.php' "+ color + " >" + f1.toString() + ", " + sign + f2.toString() + ", " + sign + f3.toFixed(2).toString() + "%</a>");
                    $("div.OTC").html("<a href='https://tw.stock.yahoo.com/t/otc.php' "+ color2 + " >" + f4.toFixed(2).toString() + ", " + sign2 + f5.toFixed(2).toString() + ", " + sign + f6.toFixed(2).toString() + "%</a>");
                }
            });
        });

    /* Air Sensor */
    /*
    $.getJSON("https://api.thingspeak.com/channels/72839/feeds.json?results=" + String(max),
        function (data) {
            $.each(data, function (key, val) {
                if (key == "feeds") {
                    for (var i = 0; i < max; i++) {
                        if (Date.now() - Date.parse(val[i].created_at) > 1800000)
                            continue;
                        if (val[i].field2) {
                            pm25 = parseInt(val[i].field2);
                            break;
                        }
                    }

                    if (pm25 == -1)
                        return;
                    else if (pm25 >= 40)
                        $("div.pm25").css("color", "red");
                    else if (pm25 >= 20)
                        $("div.pm25").css("color", "orange");

                    $("div.pm25").html("PM 2.5：" + pm25 + " ug/m3");
                }
            });
        });

    /* Miner */
    /*
    $.getJSON("https://gpumine.org/api/miner?currency=ETH&address=0x9d96b087a6279f5b5967804b1c2c3d6952e6f531",
    function (data) {
        var exist1 = data['data']['workers']['list'][0].online;
        var miner1 = parseInt(100 * data['data']['workers']['list'][0].hashrate24h / data['data']['workers']['list'][0].submitHashrate24h);
        var hashrate1 = (parseFloat(data['data']['workers']['list'][0].hashrate24h) / 1000000).toFixed(1);
        var exist2 = data['data']['workers']['list'][1].online;
        var miner2 = parseInt(100 * data['data']['workers']['list'][1].hashrate24h / data['data']['workers']['list'][1].submitHashrate24h);
        var hashrate2 = (parseFloat(data['data']['workers']['list'][1].hashrate24h) / 1000000).toFixed(1);
        var color2 = "#80FF00";

        if (exist1 == 0 || miner1 < 90) {
            $("div.miner1").css("color", "red");
            $("div.miner1").css("font-weight", "bold");
        } else if (miner1 < 95) {
            $("div.miner1").css("color", "orange");
        }

        if (exist2 == 0 || miner2 < 90) {
            $("div.miner2").css("color", "red");
            $("div.miner2").css("font-weight", "bold");
            color2 = "red";
        } else if (miner2 < 95) {
            $("div.miner2").css("color", "orange");
        }

        if (exist1)
            $("div.miner1").html("Miner1: " + hashrate1 + "M, " + miner1 + "%");
        else
            $("div.miner1").html("Miner1: Leaved....");

        if (exist2 && miner2 >= 90)
            $("div.miner2").html("<a style=\"color:" + color2 + ";\" href=\"http://hks.hiveos.farm/\">Miner2: " + hashrate2 + "M, " + miner2 + "%</a>");
        else if (exist2)
            $("div.miner2").html("Miner2: " + hashrate2 + "M, " + miner2 + "%");
        else
            $("div.miner2").html("Miner2: Leaved....");
    });


    $.getJSON("https://gpumine.org/api/bill?currency=ETH&address=0x9d96b087a6279f5b5967804b1c2c3d6952e6f531",
    function (data) {
        var reward1d = parseFloat(data['data']['calcReward24h'].coin).toFixed(4);
        var reward1d_usd = parseInt(data['data']['calcReward24h'].usd);
        var reward1d_twd = parseInt(data['data']['calcReward24h'].ntd);
        var reward1m = (reward1d * 30).toFixed(3);
        var reward1m_usd = parseInt(reward1d_usd * 30);
        var reward1m_twd = reward1d_twd * 30;
        var balance = parseFloat(data['data'].balance);


        if (reward1d > 0) {
            $("div.miner_1d").html(reward1d + " / " + reward1d_usd + "U / " + reward1d_twd);
        } else {
            $("div.miner_1d").css("color", "red")
            $("div.miner_1d").html("no data");
        }

        if (reward1m > 0) {
            $("div.miner_1m").html(reward1m + " / " + reward1m_usd + "U / " + reward1m_twd + "");
        } else {
            $("div.miner_1m").css("color", "red")
            $("div.miner_1m").html("no data");
        }

        if (balance > 0) {
            var d = new Date();
            var last_hour = parseInt((0.1-balance)/reward1d*24);
            var day = parseInt(last_hour/24);

            if (balance > 0.9)
                $("div.balance").css("color", "orange");

            if (last_hour > 24) {
                if (d.getHours() + last_hour%24 >= 15)
                    day = day+1;
                $("div.balance").html(balance.toFixed(5) + " / " + day + "D " + (last_hour % 24+1) + "H");
            } else if (last_hour > 0) {
                $("div.balance").html(balance.toFixed(5) + " / " + last_hour.toString() + "H");
            } else if (reward1d > 0) {
                if (d.getHours() <= 15)
                    $("div.balance").html(balance.toFixed(5) + " / Today");
                else
                    $("div.balance").html(balance.toFixed(5) + " / Tomorrow");
            } else {
                    $("div.balance").html(balance.toFixed(5));
            }
        }
    });
*/

    function get_eth_gas() {
        var gas = 0;
        var color = "#80FF00";
        $.getJSON("https://api.gasprice.io/v1/estimates",
            function (data) {
                    gas = parseFloat(data.result.baseFee);
                    if (gas > 60)
                        color = "red";
                    else if (gas > 40)
                        color = "orange";
                    $("div.GAS").html("<a style=\"color:" + color + ";\" href=\"https://www.gasprice.io/\">" + "ETH Gas: " + parseInt(gas).toString() + "</a>");
            }
        );
    }

    function get_geckoterminal(pool) {
        var price = 0;
        var item = "";
        if (pool == "0xfb79d843d8d7e38bd5a7f115fa889b043db6fe76") {
            item = "MCC";
            $.getJSON("https://api.geckoterminal.com/api/v2/networks/bsc/pools/" + pool,
                function (data) {
                        price = parseFloat(data.data.attributes.base_token_price_usd);
                        if (price > 0.08)
                            $("div."+item).html("<a href='https://www.geckoterminal.com/bsc/pools/" + pool + "'>" + item + ": " + price.toFixed(4).toString() + "</a>");
                }
            );
        }
        if (pool == "0x09ead9122ba8ac230746eb9730d1c099d9a6181d") {
            item = "WCC";
            $.getJSON("https://api.geckoterminal.com/api/v2/networks/bsc/pools/" + pool,
                function (data) {
                        price = parseFloat(data.data.attributes.base_token_price_usd);
                        if (price > 0.015)
                            $("div."+item).html("<a href='https://www.geckoterminal.com/bsc/pools/" + pool + "'>" + item + ": " + price.toFixed(4).toString() + "</a>");
                }
            );
        }
    }

    function get_binance(item) {

        var percent = 0;
        var percent_html = "";

        if (item == "ETHBTC" || item == "FILBTC" || item == "LINKBTC" || item == "APEBTC" || item == "UNIBTC") {
            $.getJSON("https://api.binance.com/api/v3/ticker/24hr?symbol=" + item,
                function (data) {
                    var color = "#80FF00";
                    percent = parseInt(data.priceChangePercent);
                    if (percent < 0) {
                        color = "red";
                        percent_html = " (" + percent.toString() + "%)";
                    } else if (percent > 0) {
                        percent_html = " (+" + percent.toString() + "%)";
                    } else {
                        color = "yellow";
                    }

//                    if (item == "ETHBTC") {
//                        price = parseFloat(data.lastPrice).toFixed(3);
//                        $("div." + item.toUpperCase()).html("<a style=\"color:" + color + ";\" href=\"https://www.binance.com/zh-TW/trade/" + item + "_USDT\">" + item.toUpperCase()+ ": " + String(price) + percent_html + "</a>");
//                    } else {
                        price = parseFloat(data.lastPrice).toFixed(5);
                        $("div." + item.toUpperCase()).html("<a style=\"color:" + color + ";\" href=\"https://www.binance.com/zh-TW/trade/" + item + "\">" + item.toUpperCase()+ ": " + String(price) + "</a>");
//                    }
                }
            );
            return;
        }

        $.getJSON("https://api.binance.com/api/v3/ticker/24hr?symbol=" + String(item).toUpperCase() + "USDT",
            function (data) {
                var color = "#80FF00";
                var percent = 0;
                var price = 0;

                percent = parseInt(data.priceChangePercent);
                if (percent < 0) {
                    color = "red";
                    percent_html = " (" + percent.toString() + "%)";
                } else if (percent > 0) {
                    percent_html = " (+" + percent.toString() + "%)";
                    percent_html = " (+" + percent.toString() + "%)";
                } else {
                    color = "yellow";
                }

                price = parseFloat(data.lastPrice);
                if (price >= 100)
                    price = parseInt(data.lastPrice);
                else if (price >= 1)
                    price = parseFloat(data.lastPrice).toFixed(2);
                else
                    price = parseFloat(data.lastPrice).toFixed(3);


                if (item == "BLUR")
                    $("div.BLUR").html("<a style=\"color:" + color + ";\" href=\"https://www.binance.com/zh-TW/trade/" + item + "_USDT\">" + item.toUpperCase()+ ": " + String(price) + percent_html + "</a>");
                else
                    $("div." + item.toUpperCase()).html("<a style=\"color:" + color + ";\" href=\"https://www.binance.com/zh-TW/trade/" + item + "_USDT\">" + item.toUpperCase()+ ": " + String(price) + percent_html + "</a>");
            }
        );
    }

    function get_binance_cmc(item, slug) {

        var percent = 0;
        var percent_html = "";

        $.getJSON("https://www.binance.com/bapi/composite/v1/public/promo/cmc/cryptocurrency/quotes/latest?symbol=" + item,

            function (data) {
                var color = "#80FF00";
                var percent = 0;
                var price = 0;
                var name = "";
                var i = 0;

                $.each(data.data.body.data, function (key, val) {
                    if (key == item) {

                        i = 0;
                        while(val[i].slug.length > 0) {
                            if (slug == val[i].slug)
                                break;
                            i = i + 1;
                        }

                        percent = parseInt(val[i].quote.USD.percent_change_24h);
                        if (percent < 0) {
                            color = "red";
                            percent_html = " (" + percent.toString() + "%)";
                        } else if (percent > 0) {
                            percent_html = " (+" + percent.toString() + "%)";
                        } else {
                            color = "yellow";
                        }

                        price = parseFloat(val[i].quote.USD.price);
                        if (price >= 100)
                            price = parseInt(price);
                        else if (price >= 1)
                            price = parseFloat(price).toFixed(2);
                        else if (price >= 0.01)
                            price = parseFloat(price).toFixed(3);
                        else
                            price = parseFloat(price).toFixed(4);

                        name = val[i].slug
                        $("div." + item.toUpperCase()).html("<a style=\"color:" + color + ";\" href=\"https://www.binance.com/en/price/" + name + "\">" + item.toUpperCase()+ ": " + String(price) + percent_html + "</a>");
                    }
                });
            }
        );
    }

    function set_time() {
        var d = new Date();
        $("div.time").css("color", "orange");
        $("div.time").html((d.getMonth()+1) + "/" + d.getDate() + " "+ d.toLocaleTimeString("en-US", { hour12: false , hour: "2-digit", minute: "2-digit"}));
        setTimeout(function () { set_time(); }, 1000);
    }

/*
    function get_sea() {
        $.getJSON("https://starsharks.com/go/api/market/exchange-rate",
        function (data) {
            sss = parseFloat(data['data']['sss']).toFixed(3);
            sea = parseFloat(data['data']['sea']).toFixed(4);
            $("div.SSS").html("<a href=\"https://avedex.cc/token/0xC3028FbC1742a16A5D69dE1B334cbce28f5d7EB3-bsc\">SSS: " + sss + "</a>");
            $("div.SEA").html("<a href=\"https://avedex.cc/token/0x26193c7fa4354ae49ec53ea2cebc513dc39a10aa-bsc\">SEA: " + sea + "</a>");
        });
    }

    function get_shark() {
        $.getJSON("https://starsharks.com/go/api/market/statistic",
        function (data) {
            shark = parseFloat(data['data']['selling_lowest_price']).toFixed(3);
            $("div.SHARK").html("<a href=\"https://starsharks.com/market\">Shark: " + shark + "</a>");
        });
    }
*/

    set_time();
    //get_eth_gas();
    get_binance("FIL");
    get_binance("BTC");
    get_binance("ETH");
    get_binance("SOL");
    get_binance("LINK");
    get_binance("UNI");
    get_binance("FLOW");
    get_binance("MATIC");
    get_binance("ETHBTC");
    get_binance("FILBTC");
    get_binance("LINKBTC");
    get_binance("PYTH");
    get_binance("STRK");
    get_binance("OP");
    get_binance("BLUR");
	get_binance("XAI");
    //get_binance_cmc("BLUR", "blur-token");
    get_binance("SSV");
    get_binance("ARB");
	get_binance("STX");
	get_binance("ORDI");
	get_binance("WLD");
    //get_binance_cmc("HNS", "handshake");
    get_pm25();
    get_weather();
    /* Auto Reload */
    setTimeout(function () { window.location = window.location; }, 300000);
</script>
